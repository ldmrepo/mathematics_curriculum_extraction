## 📚 **지식 그래프 관계 구축 방안 문서**

### **1. 엣지 타입 정의**

#### **1.1 구조적 관계**

| 엣지 타입 | 설명 | 방향성 | 예시 |
|-----------|------|---------|------|
| contains | 포함 관계 | 유향 | 초1-2 → [2수01-01] |
| belongs_to | 소속 관계 | 유향 | [2수01-01] → 수와 연산 |
| has_level | 수준 보유 | 유향 | [2수01-01] → A수준 |
| part_of | 부분 관계 | 유향 | 덧셈 → 사칙연산 |

#### **1.2 학습 순서 관계**

| 엣지 타입 | 설명 | 방향성 | 예시 |
|-----------|------|---------|------|
| prerequisite | 선수학습 필수 | 유향 | [2수01-01] → [4수01-01] |
| corequisite | 동시학습 권장 | 무향 | 곱셈 ↔ 나눗셈 |
| follows | 후속 학습 | 유향 | [4수01-01] → [6수01-01] |
| extends | 심화/확장 | 유향 | 기본 덧셈 → 받아올림 덧셈 |

#### **1.3 의미적 관계**

| 엣지 타입 | 설명 | 방향성 | 예시 |
|-----------|------|---------|------|
| similar_to | 유사 개념 | 무향 | 비 ↔ 비율 |
| contrasts_with | 대조 개념 | 무향 | 덧셈 ↔ 뺄셈 |
| applies_to | 응용 관계 | 유향 | 분수 → 확률 |
| generalizes | 일반화 | 유향 | 삼각형 넓이 → 다각형 넓이 |

---

### **2. 관계 가중치 테이블**

#### **2.1 가중치 체계**

| 가중치 | 의미 | 적용 기준 | 관계 타입 예시 |
|--------|------|-----------|----------------|
| 1.0 | 필수적 | 반드시 선행되어야 함 | prerequisite (교육과정 명시) |
| 0.9 | 매우 강함 | 거의 항상 연관 | contains, belongs_to |
| 0.8 | 강함 | 높은 연관성 | follows, extends |
| 0.6 | 중간 | 보통 연관성 | similar_to, corequisite |
| 0.4 | 약함 | 낮은 연관성 | applies_to |
| 0.2 | 참고 | 간접적 연관 | contrasts_with |

#### **2.2 동적 가중치 조정 규칙**

```
기본 가중치 × 조정 계수 = 최종 가중치

조정 계수:
- 같은 학년군: 1.2
- 인접 학년군: 1.0
- 비인접 학년군: 0.8
- 같은 영역: 1.1
- 다른 영역: 0.9
```

---

### **3. 선수학습 관계 매핑**

#### **3.1 수와 연산 영역**

| 선수학습 | 후속학습 | 필수도 | 근거 |
|----------|----------|--------|------|
| [2수01-01] 100까지의 수 | [2수01-04] 두 자리 수 덧셈 | 1.0 | 수 개념 필수 |
| [2수01-04] 두 자리 수 덧셈 | [4수01-02] 곱셈 | 0.9 | 반복 덧셈 |
| [4수01-11] 분수 개념 | [6수01-04] 분수 사칙연산 | 1.0 | 개념 이해 필수 |
| [6수01-04] 분수 | [9수01-02] 유리수 | 0.8 | 확장 개념 |

#### **3.2 변화와 관계 영역**

| 선수학습 | 후속학습 | 필수도 | 근거 |
|----------|----------|--------|------|
| [4수02-01] 규칙 찾기 | [6수02-02] 비례 관계 | 0.8 | 패턴 인식 |
| [6수02-01] 비와 비율 | [9수03-02] 일차함수 | 0.9 | 비례 개념 |

#### **3.3 영역 간 융합 관계**

| 선수학습 | 후속학습 | 필수도 | 설명 |
|----------|----------|--------|------|
| [4수01-02] 곱셈 | [4수03-04] 넓이 | 0.9 | 넓이 계산 |
| [6수01-05] 소수 | [6수04-02] 평균 | 0.7 | 소수 계산 |

---

### **4. 커뮤니티 클러스터 정의**

#### **4.1 클러스터링 전략**

**Level 0 (대분류)**
- Resolution: 0.1
- 예상 클러스터 수: 8-12개
- 클러스터 예시:
  - "초등 수 개념"
  - "초등 연산"
  - "중등 대수"
  - "도형 기초"

**Level 1 (중분류)**
- Resolution: 0.5
- 예상 클러스터 수: 20-30개
- 클러스터 예시:
  - "두 자리 수 연산"
  - "분수와 소수"
  - "비와 비율"
  - "평면도형 성질"

**Level 2 (소분류)**
- Resolution: 1.0
- 예상 클러스터 수: 40-60개
- 클러스터 예시:
  - "받아올림 덧셈"
  - "분수의 덧셈"
  - "삼각형의 성질"

#### **4.2 커뮤니티 특성 정의**

| 속성 | 설명 | 활용 |
|------|------|------|
| size | 노드 개수 | 커뮤니티 중요도 |
| density | 내부 연결 밀도 | 응집도 평가 |
| centrality | 중심성 점수 | 핵심 개념 식별 |
| bridge_nodes | 다리 노드 | 영역 간 연결점 |

---

### **5. 구축 프로세스**

#### **5.1 자동 구축 단계**

```python
# 1단계: 기본 관계 자동 생성
def create_basic_edges():
    edges = []
    # 학년군 → 성취기준
    for standard in achievement_standards:
        edge = {
            'source': get_grade_level(standard),
            'target': standard['code'],
            'type': 'contains',
            'weight': 0.9
        }
        edges.append(edge)
    return edges

# 2단계: 코드 패턴 기반 관계
def create_pattern_based_edges():
    # [2수01-01] → [2수01-02] (순차)
    # [2수01-*] → [4수01-*] (진급)
    pass

# 3단계: 텍스트 유사도 기반
def create_similarity_edges():
    # 임베딩 유사도 > 0.7
    pass
```

#### **5.2 수동 구축 단계**

**데이터 수집 양식 (Excel)**

| ID | Source | Target | Edge_Type | Weight | 검증상태 | 근거 |
|----|--------|--------|-----------|--------|----------|------|
| 1 | [2수01-01] | [4수01-01] | prerequisite | 1.0 | 완료 | 교육과정 명시 |
| 2 | [4수01-11] | [6수01-04] | prerequisite | 1.0 | 검토중 | 전문가 의견 |

#### **5.3 검증 프로세스**

1. **자동 검증**
   - 순환 참조 검사
   - 가중치 범위 확인
   - 노드 존재 여부

2. **수동 검증**
   - 샘플 10% 전문가 검토
   - 교육과정 문서 대조
   - 현장 교사 피드백

---

### **6. 파일 저장 구조**

```
/knowledge_graph/
├── edge_types.json           # 엣지 타입 정의
├── weight_table.csv          # 가중치 테이블
├── prerequisite_map.csv      # 선수학습 매핑
├── community_definitions.json # 커뮤니티 정의
├── auto_generated/
│   ├── basic_edges.csv
│   ├── pattern_edges.csv
│   └── similarity_edges.csv
└── manual_defined/
    ├── expert_edges.csv
    └── validation_log.csv
```

---

### **7. 예상 산출물**

| 구분 | 수량 | 설명 |
|------|------|------|
| 엣지 타입 | 12종 | 구조적(4), 학습순서(4), 의미적(4) |
| 전체 엣지 | ~4,000개 | 자동(3,500) + 수동(500) |
| 선수학습 관계 | ~300개 | 핵심 학습 경로 |
| 커뮤니티 | ~100개 | 3개 레벨 합계 |

---

### **8. 품질 보증 기준**

- **커버리지**: 모든 성취기준이 최소 2개 이상 연결
- **정확도**: 선수학습 관계 95% 이상 정확
- **일관성**: 순환 참조 0건
- **완전성**: 고아 노드 0개

---

이 문서를 `knowledge_graph_construction_guide.md`로 저장하시면, 체계적인 지식 그래프 구축이 가능합니다.